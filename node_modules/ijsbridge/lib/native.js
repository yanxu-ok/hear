"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.__define=exports.__request_callback=exports.__request=void 0;var _typeof2=_interopRequireDefault(require("@babel/runtime/helpers/typeof")),_regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),_state=require("./state"),_bridge=_interopRequireDefault(require("./bridge"));require("./interface");var __waitingForBridgeReady=function(){var e=(0,_asyncToGenerator2.default)(_regenerator.default.mark((function e(){return _regenerator.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(0,_state.__log)("bridge ready",window.__DEV__),e.next=3,new Promise((function(e,r){(0,_bridge.default)()((function(r,t){e({req:r,def:t})}))}));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),__function_callbacks={callbacks:{},offset:1,invoke:function(e,r){__function_callbacks.callbacks[e]&&__function_callbacks.callbacks[e].apply(null,r)},trigger:function(e,r){__function_callbacks.invoke(e,r),delete __function_callbacks.callbacks[e]},filter:function(e){if(window.ijsbridge_callbacks||(window.ijsbridge_callbacks=__function_callbacks),Array.isArray(e)){for(var r in e)e[r]=__function_callbacks.filter(e[r]);return e}if(e&&"object"==(0,_typeof2.default)(e)){for(var t in e)e[t]=__function_callbacks.filter(e[t]);return e}return"function"==typeof e&&(__function_callbacks.offset++,__function_callbacks.callbacks[__function_callbacks.offset]=e,e=__function_callbacks.offset),e}},__request=function(){var e=(0,_asyncToGenerator2.default)(_regenerator.default.mark((function e(r,t){return _regenerator.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(0,_state.__log)((0,_state.__get_mode)()," call native __request",r,t),e.next=3,new Promise((function(e,n){__request_callback(r,t,(function(r){var t=r.err,n=r.result;e({err:t,result:n})}))}));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}();exports.__request=__request;var __request_callback=function(){var e=(0,_asyncToGenerator2.default)(_regenerator.default.mark((function e(r,t,n){var a;return _regenerator.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(0,_state.__log)((0,_state.__get_mode)()," call native __request_callback",r,t),e.next=3,__waitingForBridgeReady();case 3:a=e.sent,t=__function_callbacks.filter(t),a.req(r,t,(function(e,r){(0,_state.__log)((0,_state.__get_mode)()," native __request result",e,r),n({err:e,result:r})}));case 6:case"end":return e.stop()}}),e)})));return function(r,t,n){return e.apply(this,arguments)}}();exports.__request_callback=__request_callback;var __define=function(){var e=(0,_asyncToGenerator2.default)(_regenerator.default.mark((function e(r,t){return _regenerator.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(0,_state.__log)((0,_state.__get_mode)()," call native __define",r),e.next=3,__waitingForBridgeReady();case 3:return e.sent.def(r,function(){var e=(0,_asyncToGenerator2.default)(_regenerator.default.mark((function e(r,n){var a,_;return _regenerator.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(0,_state.__log)((0,_state.__get_mode)()," call native __define",r),e.prev=1,e.next=4,Promise.resolve(t(r));case 4:(a=e.sent)&&"object"==(0,_typeof2.default)(a)&&void 0!==a.error?(_=a.error,delete a.error,n(_,a.result?a.result:a)):n(!1===a?"错误":null,a),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),n(""+e.t0.message,null);case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(r,t){return e.apply(this,arguments)}}()),e.abrupt("return",!0);case 6:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}();exports.__define=__define;
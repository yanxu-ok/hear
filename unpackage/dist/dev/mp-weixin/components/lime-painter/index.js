(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["components/lime-painter/index"],{482:
/*!*********************************************************!*\
  !*** F:/test/1312312/components/lime-painter/index.vue ***!
  \*********************************************************/
/*! no static exports found */function(t,e,n){"use strict";n.r(e);var r=n(/*! ./index.vue?vue&type=template&id=3806f0d1& */483),i=n(/*! ./index.vue?vue&type=script&lang=js& */485);for(var a in i)"default"!==a&&function(t){n.d(e,t,(function(){return i[t]}))}(a);var o,s=n(/*! ./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js */11),c=Object(s["default"])(i["default"],r["render"],r["staticRenderFns"],!1,null,null,null,!1,r["components"],o);c.options.__file="components/lime-painter/index.vue",e["default"]=c.exports},483:
/*!****************************************************************************************!*\
  !*** F:/test/1312312/components/lime-painter/index.vue?vue&type=template&id=3806f0d1& ***!
  \****************************************************************************************/
/*! exports provided: render, staticRenderFns, recyclableRender, components */function(t,e,n){"use strict";n.r(e);var r=n(/*! -!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--16-0!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib??vue-loader-options!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=template&id=3806f0d1& */484);n.d(e,"render",(function(){return r["render"]})),n.d(e,"staticRenderFns",(function(){return r["staticRenderFns"]})),n.d(e,"recyclableRender",(function(){return r["recyclableRender"]})),n.d(e,"components",(function(){return r["components"]}))},484:
/*!****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--16-0!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib??vue-loader-options!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!F:/test/1312312/components/lime-painter/index.vue?vue&type=template&id=3806f0d1& ***!
  \****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/*! exports provided: render, staticRenderFns, recyclableRender, components */function(t,e,n){"use strict";var r;n.r(e),n.d(e,"render",(function(){return i})),n.d(e,"staticRenderFns",(function(){return o})),n.d(e,"recyclableRender",(function(){return a})),n.d(e,"components",(function(){return r}));var i=function(){var t=this,e=t.$createElement;t._self._c},a=!1,o=[];i._withStripped=!0},485:
/*!**********************************************************************************!*\
  !*** F:/test/1312312/components/lime-painter/index.vue?vue&type=script&lang=js& ***!
  \**********************************************************************************/
/*! no static exports found */function(t,e,n){"use strict";n.r(e);var r=n(/*! -!./node_modules/babel-loader/lib!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--12-1!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib??vue-loader-options!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=script&lang=js& */486),i=n.n(r);for(var a in r)"default"!==a&&function(t){n.d(e,t,(function(){return r[t]}))}(a);e["default"]=i.a},486:
/*!*****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/babel-loader/lib!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--12-1!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib??vue-loader-options!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!F:/test/1312312/components/lime-painter/index.vue?vue&type=script&lang=js& ***!
  \*****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/*! no static exports found */function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=i(n(/*! ./node_modules/@vue/babel-preset-app/node_modules/@babel/runtime/regenerator */72));function i(t){return t&&t.__esModule?t:{default:t}}function a(t,e){return l(t)||u(t,e)||s(t,e)||o()}function o(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function s(t,e){if(t){if("string"===typeof t)return c(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(t,e):void 0}}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function u(t,e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t)){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(r=(o=s.next()).done);r=!0)if(n.push(o.value),e&&n.length===e)break}catch(c){i=!0,a=c}finally{try{r||null==s["return"]||s["return"]()}finally{if(i)throw a}}return n}}function l(t){if(Array.isArray(t))return t}function d(t,e,n,r,i,a,o){try{var s=t[a](o),c=s.value}catch(u){return void n(u)}s.done?e(c):Promise.resolve(c).then(r,i)}function f(t){return function(){var e=this,n=arguments;return new Promise((function(r,i){var a=t.apply(e,n);function o(t){d(a,r,i,o,s,"next",t)}function s(t){d(a,r,i,o,s,"throw",t)}o(void 0)}))}}var h=function(t){String.prototype.toPx=function(e,n){var r=e?/^-?[0-9]+([.]{1}[0-9]+){0,1}(rpx|px|%)$/g:/^[0-9]+([.]{1}[0-9]+){0,1}(rpx|px|%)$/g,i=r.exec(this);if(!this||!i)return 0;var a=i[2],o=parseFloat(this),s=0;return"rpx"===a?s=Math.round(o*(t||.5)*1):"px"===a?s=Math.round(1*o):"%"===a&&(s=Math.round(o*n/100)),s}},v={props:{board:{type:Object},isAsync:{type:Boolean,default:!0},pixelRatio:Number,customStyle:String,isRenderImage:Boolean},data:function(){return{timer:null,id:"painter"}},watch:{board:{handler:"drawAll"}},computed:{dpr:function(){return this.pixelRatio||t.getSystemInfoSync().pixelRatio},windowWidth:function(){return t.getSystemInfoSync().windowWidth},boardWidth:function(){var t=this.board||{},e=t.width,n=void 0===e?200:e;return n},boardHeight:function(){var t=this.board||{},e=t.height,n=void 0===e?200:e;return n}},created:function(){this.init()},mounted:function(){this.context&&this.drawAll()},methods:{initBoard:function(){var t=this;return f(r.default.mark((function e(){var n,i,a;return r.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(i=t.board,!(null===i||void 0===i?void 0:null===(n=i.views)||void 0===n?void 0:n.length)){e.next=6;break}return e.next=4,Promise.all(i.views.map(function(){var e=f(r.default.mark((function e(n){var i,a,o,s;return r.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("image"!==n.type){e.next=8;break}return e.next=3,t.getImageInfo(n.url);case 3:return i=e.sent,a=i.height,o=i.width,s=i.path,e.abrupt("return",Object.assign({},n,{height:a,width:o,url:s}));case 8:return e.abrupt("return",n);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 4:return a=e.sent,e.abrupt("return",a||[]);case 6:return e.abrupt("return",[]);case 7:case"end":return e.stop()}}),e)})))()},init:function(){this.context=t.createCanvasContext(this.id,this),h(this.windowWidth/750)},draw:function(t){var e=this;this.context.setFillStyle(t.background||"white"),this.context.fillRect(t.css.left.toPx(),t.css.top.toPx(),t.css.width.toPx(),t.css.height.toPx()),this.context.clip(),this.drawView(this.context,t),this.context.draw(!0,(function(){e.isRenderImage&&setTimeout((function(){e.saveImgToLocal()}),100)}))},drawAll:function(){var t=this;return f(r.default.mark((function e(){var n,i,a,o,s,c;return r.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t.isAsync){e.next=6;break}return e.next=3,t.initBoard();case 3:e.t0=e.sent,e.next=7;break;case 6:e.t0=t.board.views;case 7:if(o=e.t0,t.context&&o.length){e.next=10;break}return e.abrupt("return");case 10:s=t.drawRect(t.context,{type:"view",css:{left:"".concat((null===(n=t.board)||void 0===n?void 0:n.left)||0),top:"".concat((null===(i=t.board)||void 0===i?void 0:i.top)||0),width:"".concat(t.boardWidth),height:"".concat(t.boardHeight),background:null===(a=t.board)||void 0===a?void 0:a.background}}),c=o.map((function(e){return t.drawView(t.context,e)}))||[Promise.resolve()],Promise.all([s].concat(c)).then((function(e){t.context.draw(!0,(function(){t.isRenderImage&&(clearTimeout(t.timer),t.timer=setTimeout((function(){t.saveImgToLocal()}),100))}))}));case 13:case"end":return e.stop()}}),e)})))()},saveImgToLocal:function(){var e=this;t.canvasToTempFilePath({canvasId:this.id,destWidth:this.toNumber(this.boardWidth)*this.dpr,destHeight:this.toNumber(this.boardHeight)*this.dpr,success:function(){var t=f(r.default.mark((function t(n){var i;return r.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getImageInfo(n.tempFilePath);case 2:i=t.sent,i.path&&e.$emit("success",i.path);case 4:case"end":return t.stop()}}),t)})));function n(e){return t.apply(this,arguments)}return n}(),fail:function(t){console.error("canvasToTempFilePath failed, ".concat(JSON.stringify(t))),e.$emit("fail",{error:t})}},this)},drawView:function(t,e){var n=this;return f(r.default.mark((function i(){var a,o,s,c,u,l;return r.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if("view"!=e.type){r.next=4;break}return r.abrupt("return",n.drawRect(t,e));case 4:if("image"!=e.type){r.next=20;break}if(!n.isAsync){r.next=9;break}return r.abrupt("return",n.drawRect(t,e));case 9:return r.next=11,n.getImageInfo(e.url);case 11:return a=r.sent,o=a.height,s=void 0===o?0:o,c=a.width,u=void 0===c?0:c,l=a.path,r.abrupt("return",n.drawRect(t,Object.assign(e,{height:s,width:u,url:l})));case 18:r.next=22;break;case 20:if("text"!=e.type){r.next=22;break}return r.abrupt("return",n.drawText(t,e));case 22:case"end":return r.stop()}}),i)})))()},toNumber:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return"string"===typeof t?t.toPx(e,n):"number"===typeof t?t:0},base64src:function(e){return new Promise((function(n,r){var i=t.getFileSystemManager(),o=/data:image\/(\w+);base64,(.*)/.exec(e)||[],s=a(o,3),c=s[1],u=s[2];c||r(new Error("ERROR_BASE64SRC_PARSE"));var l=(new Date).getTime(),d="".concat(wx.env.USER_DATA_PATH,"/").concat(l,".").concat(c),f=t.base64ToArrayBuffer(u);i.writeFile({filePath:d,data:f,encoding:"binary",success:function(){n(d)},fail:function(t){r(),this.$emit("fail",{error:t}),console.log("获取base64图片失败",t)}})}))},getImageInfo:function(e){var n=this;return new Promise(function(){var i=f(r.default.mark((function i(a,o){return r.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(!/^data:image\/(\w+);base64/.test(e)){r.next=4;break}return r.next=3,n.base64src(e);case 3:e=r.sent;case 4:t.getImageInfo({src:e,success:function(t){t.path=/^(http|\/\/|\/|wxfile|data:image\/(\w+);base64|file|bdfile)/.test(t.path)?t.path:"/".concat(t.path),a(t)},fail:function(t){o(),n.$emit("fail",{error:t}),console.log("获取图片失败",t,e)}});case 5:case"end":return r.stop()}}),i)})));return function(t,e){return i.apply(this,arguments)}}())},downloadImage:function(e){return new Promise((function(n,r){t.downloadFile({url:e,success:function(t){if(200!==t.statusCode)return console.error("downloadFile ".concat(e," failed res.statusCode is not 200")),void r();n(t.tempFilePath)},fail:function(r){t.showToast({title:r}),console.error("downloadFile ".concat(e," failed ").concat(JSON.stringify(r))),n(e)}})}))},measureText:function(t,e,n){return t.measureText(e).width},calcTextArrs:function(t,e){var n=e.text.split("\n"),r="bold"===e.css.fontWeight?"bold":"normal",i="italic"===e.css.textStyle?"italic":"normal",a=e.css.fontSize?this.toNumber(e.css.fontSize):"20rpx".toPx(),o=e.css.fontFamily||"sans-serif";t.font="".concat(i," ").concat(r," ").concat(a,"px ").concat(o);for(var s=0,c=0,u=0,l=[],d=0;d<n.length;d++){var f=n[d],h=this.measureText(t,f,a),v=a,b=e.css.width?this.toNumber(e.css.width):h;b<v&&(b=v);var p=Math.ceil(h/b);s=b>s?b:s,u+=p,l[d]=p}u=e.css.maxLines<u?e.css.maxLines:u;var m=e.css.lineHeight?"number"===typeof e.css.lineHeight?this.toNumber(e.css.lineHeight)*a:this.toNumber(e.css.lineHeight):1.2*a;return c=m*u,{fontSize:a,width:s,height:c,lines:u,lineHeight:m,textArray:n,linesArray:l}},drawText:function(t,e){var n=this;return new Promise(function(){var i=f(r.default.mark((function i(a,o){var s,c,u,l,d,f,h,v,b,p,m,x,w,g,y,k,P,T,S;return r.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:c=n.calcTextArrs(t,e),u=c.width,c.height,l=c.lines,d=c.lineHeight,f=c.textArray,h=c.linesArray,v=c.fontSize,t.fillStyle=(null===(s=e.css)||void 0===s?void 0:s.color)||"black",b=0,p=0;case 4:if(!(p<f.length)){r.next=62;break}m=Math.ceil(f[p].length/h[p]),x=0,w=0,g=0;case 9:if(!(g<h[p])){r.next=59;break}if(t.save(),!(b>=l)){r.next=13;break}return r.abrupt("break",59);case 13:w=m,y=f[p].substr(x,w),k=n.measureText(t,y,v);case 16:if(!(x+w<=f[p].length&&(u-k>v||k-u>v))){r.next=27;break}if(!(k<u)){r.next=21;break}y=f[p].substr(x,++w),r.next=24;break;case 21:if(!(y.length<=1)){r.next=23;break}return r.abrupt("break",27);case 23:y=f[p].substr(x,--w);case 24:k=n.measureText(t,y,v),r.next=16;break;case 27:if(x+=y.length,b!==l-1||!(p<f.length-1||x<f[p].length)){r.next=37;break}case 29:if(!(n.measureText(t,"".concat(y,"..."),v)>u)){r.next=35;break}if(!(y.length<=1)){r.next=32;break}return r.abrupt("break",35);case 32:y=y.substring(0,y.length-1),r.next=29;break;case 35:y+="...",k=n.measureText(t,y,v);case 37:t.setTextAlign(e.css.textAlign?e.css.textAlign:"left"),P=n.toNumber(e.css.left),T=void 0,r.t0=e.css.textAlign,r.next="center"===r.t0?43:"right"===r.t0?46:49;break;case 43:return P=P+k/2+((n.toNumber(e.css.width)||n.toNumber(n.boardWidth,0,n.windowWidth))-k)/2,T=P-k/2,r.abrupt("break",51);case 46:return P+=n.toNumber(e.css.width)||n.toNumber(n.boardWidth,0,n.windowWidth),T=P-k,r.abrupt("break",51);case 49:return T=P,r.abrupt("break",51);case 51:S=n.toNumber(e.css.top)+(0===b?v:v+b*d),b++,"stroke"===e.css.textStyle?t.strokeText(y,P,S,k):t.fillText(y,P,S,k*n.dpr),e.css.textDecoration&&(t.lineWidth=v/13,t.beginPath(),/\bunderline\b/.test(e.css.textDecoration)&&(t.moveTo(T,S),t.lineTo(T+k,S)),/\boverline\b/.test(e.css.textDecoration)&&(t.moveTo(T,S-v),t.lineTo(T+k,S-v)),/\bline-through\b/.test(e.css.textDecoration)&&(t.moveTo(T,S-v/2.5),t.lineTo(T+k,S-v/2.5)),t.closePath(),t.strokeStyle=e.css.color,t.stroke()),t.restore();case 56:g++,r.next=9;break;case 59:p++,r.next=4;break;case 62:setTimeout((function(){return a("ok")}),100);case 63:case"end":return r.stop()}}),i)})));return function(t,e){return i.apply(this,arguments)}}())},drawRect:function(t,e){return new Promise((function(n,r){var i,o,s,c,u,l,d,f,h,v,b,p,m,x,w=(null===(i=e.css)||void 0===i?void 0:null===(o=i.left)||void 0===o?void 0:o.toPx())||0,g=(null===(s=e.css)||void 0===s?void 0:null===(c=s.top)||void 0===c?void 0:c.toPx())||0,y=(null===(u=e.css)||void 0===u?void 0:u.width.toPx())||0,k=(null===(l=e.css)||void 0===l?void 0:l.height.toPx())||0,P=(null===(d=e.css)||void 0===d?void 0:null===(f=d.radius)||void 0===f?void 0:f.split(" ").map((function(t){return/^\d/.test(t)&&t.toPx(0,y)}),[]))||[0],T=a(P,4),S=T[0],I=T[1],A=T[2],R=T[3],M=S;I=I||S,A=A||S,R=R||I;var F=(null===(h=e.css)||void 0===h?void 0:h.backgroundColor)||(null===(v=e.css)||void 0===v?void 0:v.background)||"white",N=null===(b=e.css)||void 0===b?void 0:null===(p=b.border)||void 0===p?void 0:p.split(" ").map((function(t){return/^\d/.test(t)?t.toPx():t})),W=null===(m=e.css)||void 0===m?void 0:m.shadow,O=null===(x=e.css)||void 0===x?void 0:x.rotate;if(t.save(),t.setFillStyle(F),O&&(t.translate(w+y/2,g+k/2),t.rotate(O*Math.PI/180),t.translate(-w-y/2,-g-k/2)),W){var _=W.split(" "),H=a(_,4),j=H[0],C=H[1],D=H[2],$=H[3];t.shadowOffsetX=j.toPx(),t.shadowOffsetY=C.toPx(),t.shadowBlur=D.toPx(),t.shadowColor=$}if(M?(t.beginPath(),t.arc(w+y-(A||M),g+k-(A||M),A||M,0,.5*Math.PI),t.lineTo(w+(R||M),g+k),t.arc(w+(R||M),g+k-(R||M),R||M,.5*Math.PI,Math.PI),t.lineTo(w,g+M),t.arc(w+M,g+M,M,Math.PI,1.5*Math.PI),t.lineTo(w+y-(I||M),g),t.arc(w+y-(I||M),g+(I||M),I||M,1.5*Math.PI,2*Math.PI),t.closePath(),t.fill()):t.fillRect(w,g,y,k),"image"==(null===e||void 0===e?void 0:e.type)){t.fillStyle="white",M&&t.clip();var B=e.width,E=e.height,L=0,z=0,J=y/k,V=B/E;J>=V?E=B/J:(B=E*J,L=Math.round((e.width-B)/2)),e.css&&"scaleToFill"===e.mode?t.drawImage(e.url,w,g,y,k):t.drawImage(e.url,L,z,B,E,w,g,y,k)}if(N){var U=N[0];t.lineWidth=U,"dashed"==N[1]?t.setLineDash([Math.ceil(4*U/3),Math.ceil(4*U/3)]):"dotted"==N[1]&&t.setLineDash([U,U]),t.setStrokeStyle(N[2]),M?t.stroke():t.strokeRect(w,g,y,k)}t.restore(),setTimeout((function(){return n("ok")}),50)}))}}};e.default=v}).call(this,n(/*! ./node_modules/@dcloudio/uni-mp-weixin/dist/index.js */1)["default"])}}]);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/components/lime-painter/index.js.map
;(global["webpackJsonp"] = global["webpackJsonp"] || []).push([
    'components/lime-painter/index-create-component',
    {
        'components/lime-painter/index-create-component':(function(module, exports, __webpack_require__){
            __webpack_require__('1')['createComponent'](__webpack_require__(482))
        })
    },
    [['components/lime-painter/index-create-component']]
]);
